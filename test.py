import numpy as np
import scipy as sp

from cones import quantcondentr
from utils import symmetric as sym

np.random.seed(1)

n = 4
m = 4
nm = n*m

K = quantcondentr.QuantCondEntropy(n, m)

# A = np.random.rand(nm, nm)
# X = A * A.T + np.eye(nm)

HX=np.array([[8.2311502577864521e+03, 1.4067594185985058e-11, 4.1941909351568264e-10, 3.0498732191538726e-06, -2.5984967348638847e-07, -1.2667545463670047e+03, -1.7310805271324959e-12, -3.7456713824247748e-11, 2.3738188942656919e-10, -2.0623921868701781e-11, -4.8305762776462971e+03, -1.0932153364055009e-12, -1.7138862581542804e-06, -3.0107959137812399e-10, -7.2224345772637090e-11, -5.8547564204178143e+03, ], [1.4067594185985058e-11, 1.3201795310779467e+04, 8.8939335119403782e-11, 2.6771799153413929e-06, 1.6337398607137787e-13, -1.3224020329378736e-07, 1.8627110268186664e-13, 1.1162112160139265e-12, 2.3728119049267085e-13, 2.4268137872939850e-10, 6.2215923438500936e-12, 2.2158171333938398e-13, -3.7045519234964176e-13, -1.7154189404469865e-06, 1.0572812487147841e-13, 6.5377915768409832e-12, ], [4.1941909351568264e-10, 8.8939335119403782e-11, 1.3202608754662317e+04, 4.8601161192368363e-06, 1.9872656513608139e-11, -1.3921676766902041e-14, -8.4086739641731758e-08, 8.5188495332372856e-13, -9.7753999567601630e-11, -3.5657480681245378e-11, 2.4448939418340259e-10, 3.6099941408344454e-14, -3.5282449678832927e-10, -9.1929794970346964e-13, -1.7139405522468664e-06, 1.2417608015687789e-12, ], [3.0498732191538726e-06, 2.6771799153413929e-06, 4.8601161192368363e-06, 1.3202621215662177e+04, 3.5480448250425056e-11, 4.1630296422271210e-11, -1.5564620087666004e-11, 3.0147647180694296e-07, -5.9553272041380297e-11, 3.5890615270716140e-11, 1.4766944441350222e-13, 3.8659506504297139e-10, -1.9936297526519573e-12, 2.1658201570037769e-11, 2.3600160818170018e-11, -1.7139170125427540e-06, ], [-2.5984967348638847e-07, 1.6337398607137787e-13, 1.9872656513608139e-11, 3.5480448250425056e-11, 3.0959919325190480e+04, -1.7070654874739351e-11, 1.8789565330623352e-10, 9.6405128539470586e-11, -4.1698996490789820e-07, 5.9446845858608778e-11, 8.9115003524938546e-13, -2.6218096504607041e-11, -1.3900003839174458e-07, -5.1015465610261875e-11, -1.7057722452913795e-11, 4.6160755919106701e-13, ], [-1.2667545463670047e+03, -1.3224020329378736e-07, -1.3921676766902041e-14, 4.1630296422271210e-11, -1.7070654874739351e-11, 3.0632238655976660e+04, 1.6922230979944072e-10, 2.0209091743617983e-09, -7.9155832198870212e-14, 9.7849395651169570e-07, -1.2308543906981790e+03, 2.6721309771637314e-11, 1.9415379767195126e-10, -1.3054846211631138e-07, 1.4967887310276435e-10, -1.4918316648210491e+03, ], [-1.7310805271324959e-12, 1.8627110268186664e-13, -8.4086739641731758e-08, -1.5564620087666004e-11, 1.8789565330623352e-10, 1.6922230979944072e-10, 3.0959900438096811e+04, -6.8731756242186280e-11, 2.0048139315168373e-11, 4.1301735626718188e-11, 4.2688897982265087e-07, 1.1497207410582108e-11, -2.0454995316150244e-10, 1.3994265459317009e-11, -1.3893278452372484e-07, -3.5888752485218889e-12, ], [-3.7456713824247748e-11, 1.1162112160139265e-12, 8.5188495332372856e-13, 3.0147647180694296e-07, 9.6405128539470586e-11, 2.0209091743617983e-09, -6.8731756242186280e-11, 3.0960005207566835e+04, -2.6250013764145318e-11, -6.7543214280406435e-11, -3.7010619460431682e-11, -1.9178989195699863e-07, 1.4298543625391559e-11, -9.5936784236068145e-14, -6.2907320598421651e-12, -1.3897294550774683e-07, ], [2.3738188942656919e-10, 2.3728119049267085e-13, -9.7753999567601630e-11, -5.9553272041380297e-11, -4.1698996490789820e-07, -7.9155832198870212e-14, 2.0048139315168373e-11, -2.6250013764145318e-11, 1.3207142836642881e+04, -3.6447300101033164e-11, 4.1550243364620090e-10, 2.2001915937399843e-11, -1.5941440390000035e-06, 5.0062128592753446e-11, 1.8043101804663299e-12, 7.8989669892859654e-12, ], [-2.0623921868701781e-11, 2.4268137872939850e-10, -3.5657480681245378e-11, 3.5890615270716140e-11, 5.9446845858608778e-11, 9.7849395651169570e-07, 4.1301735626718188e-11, -6.7543214280406435e-11, -3.6447300101033164e-11, 1.3206325549281930e+04, 5.6882213898662808e-11, 3.0299582925463233e-10, -2.3122116262981791e-11, -1.1860708905676893e-06, 2.0857170741701672e-11, -2.2938125171227748e-11, ], [-4.8305762776462971e+03, 6.2215923438500936e-12, 2.4448939418340259e-10, 1.4766944441350222e-13, 8.9115003524938546e-13, -1.2308543906981790e+03, 4.2688897982265087e-07, -3.7010619460431682e-11, 4.1550243364620090e-10, 5.6882213898662808e-11, 8.5134562798034895e+03, -6.4798621473353340e-12, -5.6714561037030375e-11, -1.1813759557117230e-10, -1.5805812301480064e-06, -5.6888405987549631e+03, ], [-1.0932153364055009e-12, 2.2158171333938398e-13, 3.6099941408344454e-14, 3.8659506504297139e-10, -2.6218096504607041e-11, 2.6721309771637314e-11, 1.1497207410582108e-11, -1.9178989195699863e-07, 2.2001915937399843e-11, 3.0299582925463233e-10, -6.4798621473353340e-12, 1.3207153347273292e+04, 1.4573075864466887e-12, -2.9157519778560773e-11, 3.3635752381393700e-12, -1.0422057610983666e-06, ], [-1.7138862581542804e-06, -3.7045519234964176e-13, -3.5282449678832927e-10, -1.9936297526519573e-12, -1.3900003839174458e-07, 1.9415379767195126e-10, -2.0454995316150244e-10, 1.4298543625391559e-11, -1.5941440390000035e-06, -2.3122116262981791e-11, -5.6714561037030375e-11, 1.4573075864466887e-12, 1.4028267707709965e+04, 2.6546023561319972e-11, 4.6181797022927934e-10, 5.8432037220370622e-12, ], [-3.0107959137812399e-10, -1.7154189404469865e-06, -9.1929794970346964e-13, 2.1658201570037769e-11, -5.1015465610261875e-11, -1.3054846211631138e-07, 1.3994265459317009e-11, -9.5936784236068145e-14, 5.0062128592753446e-11, -1.1860708905676893e-06, -1.1813759557117230e-10, -2.9157519778560773e-11, 2.6546023561319972e-11, 1.4027380763304463e+04, 6.3026869219927185e-11, 1.2620398028215178e-10, ], [-7.2224345772637090e-11, 1.0572812487147841e-13, -1.7139405522468664e-06, 2.3600160818170018e-11, -1.7057722452913795e-11, 1.4967887310276435e-10, -1.3893278452372484e-07, -6.2907320598421651e-12, 1.8043101804663299e-12, 2.0857170741701672e-11, -1.5805812301480064e-06, 3.3635752381393700e-12, 4.6181797022927934e-10, 6.3026869219927185e-11, 1.4028265656721676e+04, 1.3819673746827846e-11, ], [-5.8547564204178143e+03, 6.5377915768409832e-12, 1.2417608015687789e-12, -1.7139170125427540e-06, 4.6160755919106701e-13, -1.4918316648210491e+03, -3.5888752485218889e-12, -1.3897294550774683e-07, 7.8989669892859654e-12, -2.2938125171227748e-11, -5.6888405987549631e+03, -1.0422057610983666e-06, 5.8432037220370622e-12, 1.2620398028215178e-10, 1.3819673746827846e-11, 7.1332867021587226e+03, ],])
Ht=7779.742747095748
t=-32075.369431035284
X=np.array([[7.1807720787425224e+03, -5.8323450428317576e-09, 1.0576011732731251e-10, 1.1265143673404078e-07, -1.2313426447983693e-08, 3.3092529596654066e+02, 4.2668525511805848e-09, 2.7458602233818849e-09, 1.1007751575219758e-11, 3.8331523037814504e-09, 4.7148745499130755e+03, 8.9079115518109123e-08, 1.2867277477466538e-09, 9.3482029456923363e-08, 4.4586236428078324e-08, 7.5926541334340091e+03, ], [-5.8323450428317576e-09, 7.9720122224187131e+00, 1.5624085042892426e-09, 1.2473101001868853e-07, -1.4394260473019720e-15, -3.3574585158455512e-10, 7.7406621755818339e-16, 2.4082667454164351e-15, 5.6310513654819195e-15, -9.9376956691963650e-14, -3.7042923626330094e-09, 2.5482207031997849e-16, -3.4117929836440937e-15, -5.7427614662498932e-11, 1.4778536195200401e-15, -5.9081931657789675e-09, ], [1.0576011732731251e-10, 1.5624085042892426e-09, 1.7719064273700978e+03, 3.2289933863506443e-07, 3.4007925659451821e-15, 2.8903837158008596e-12, -9.6269471838398080e-09, -4.3141026477915752e-15, -3.2325982305256198e-12, -3.5605597491889616e-13, 1.5827249064601181e-11, 1.0436084314417211e-16, 6.5644407204652471e-12, 2.5133417324298241e-15, -1.2698927098923122e-08, 5.4876824445068707e-11, ], [1.1265143673404078e-07, 1.2473101001868853e-07, 3.2289933863506443e-07, 4.5489618414448378e+03, 4.0283584876305424e-13, 2.3816729835949515e-09, -1.7799801900316063e-13, 2.2275756515756574e-08, -2.0323145133390063e-12, 1.6035683644824823e-14, 2.9020045656129226e-08, -2.6735623683128391e-11, 7.0269727290301754e-15, -1.6367109832605715e-13, 2.0700868830708824e-12, 1.1469626965838961e-08, ], [-1.2313426447983693e-08, -1.4394260473019720e-15, 3.4007925659451821e-15, 4.0283584876305424e-13, 2.1192450616628744e+02, -6.7030472832151946e-10, 6.5262789654826583e-12, 3.9960536593194291e-09, -1.6331637738883268e-08, -2.1327109876451343e-14, -6.4290970194677159e-09, -3.2945547864501338e-13, -2.7317279191174403e-09, 2.7386527901897596e-14, -3.4090758232953601e-13, -1.0015541509455579e-08, ], [3.3092529596654066e+02, -3.3574585158455512e-10, 2.8903837158008596e-12, 2.3816729835949515e-09, -6.7030472832151946e-10, 2.0401973469529963e+01, 4.5356930103856750e-10, 7.7849305909640272e-09, 2.6056981995455312e-12, 3.3110768797817806e-10, 3.0328579595452368e+02, 6.9184004626828284e-09, 1.2803478533356492e-09, 6.5684118531398687e-09, 3.5944299209716357e-09, 5.1258896675578285e+02, ], [4.2668525511805848e-09, 7.7406621755818339e-16, -9.6269471838398080e-09, -1.7799801900316063e-13, 6.5262789654826583e-12, 4.5356930103856750e-10, 1.8078360628138324e+02, 1.3827970369109706e-08, 9.9313231893397424e-15, 9.1488956235172239e-15, 7.0127805915269880e-09, 2.0716100106296760e-13, -1.1974881892789756e-12, -5.0600857216497490e-14, -2.3304108770903399e-09, 6.1958812465553278e-09, ], [2.7458602233818849e-09, 2.4082667454164351e-15, -4.3141026477915752e-15, 2.2275756515756574e-08, 3.9960536593194291e-09, 7.7849305909640272e-09, 1.3827970369109706e-08, 4.6412137834138065e+02, -1.0764042766226927e-12, 2.6487903480320342e-13, 2.4836917077589321e-09, 8.9878987635274528e-09, 1.7182171125606329e-13, 6.6385806799716950e-14, -2.0476791576342204e-13, -1.5062730569320907e-09, ], [1.1007751575219758e-11, 5.6310513654819195e-15, -3.2325982305256198e-12, -2.0323145133390063e-12, -1.6331637738883268e-08, 2.6056981995455312e-12, 9.9313231893397424e-15, -1.0764042766226927e-12, 2.0759164052542078e+03, -1.8275730460948012e-09, 9.9528117397286780e-11, 3.9145556452360258e-08, -1.0318117029102407e-07, 9.9446131164085698e-14, 1.1991626100749824e-13, 5.0418793226931838e-11, ], [3.8331523037814504e-09, -9.9376956691963650e-14, -3.5605597491889616e-13, 1.6035683644824823e-14, -2.1327109876451343e-14, 3.3110768797817806e-10, 9.1488956235172239e-15, 2.6487903480320342e-13, -1.8275730460948012e-09, 7.9673714105960958e+00, 5.1054276436987547e-09, 7.5216626354537284e-08, 2.2742748407087202e-13, -3.0793342080004193e-10, 1.7515557943344401e-13, 5.6745605532123982e-09, ], [4.7148745499130755e+03, -3.7042923626330094e-09, 1.5827249064601181e-11, 2.9020045656129226e-08, -6.4290970194677159e-09, 3.0328579595452368e+02, 7.0127805915269880e-09, 2.4836917077589321e-09, 9.9528117397286780e-11, 5.1054276436987547e-09, 6.1245770223289728e+03, 2.1862104774882363e-07, 1.5112716067508390e-08, 8.6837236170174419e-08, -2.4140510132800076e-08, 7.0298294089207484e+03, ], [8.9079115518109123e-08, 2.5482207031997849e-16, 1.0436084314417211e-16, -2.6735623683128391e-11, -3.2945547864501338e-13, 6.9184004626828284e-09, 2.0716100106296760e-13, 8.9878987635274528e-09, 3.9145556452360258e-08, 7.5216626354537284e-08, 2.1862104774882363e-07, 4.5463139356387619e+03, -1.5942653543932119e-13, -3.0042364461660990e-13, 4.5783251231970019e-13, 1.2762992130883418e-07, ], [1.2867277477466538e-09, -3.4117929836440937e-15, 6.5644407204652471e-12, 7.0269727290301754e-15, -2.7317279191174403e-09, 1.2803478533356492e-09, -1.1974881892789756e-12, 1.7182171125606329e-13, -1.0318117029102407e-07, 2.2742748407087202e-13, 1.5112716067508390e-08, -1.5942653543932119e-13, 1.8679735245553807e+03, -1.6447602079867515e-09, 6.1696905899076716e-11, 5.7980872670520632e-08, ], [9.3482029456923363e-08, -5.7427614662498932e-11, 2.5133417324298241e-15, -1.6367109832605715e-13, 2.7386527901897596e-14, 6.5684118531398687e-09, -5.0600857216497490e-14, 6.6385806799716950e-14, 9.9446131164085698e-14, -3.0793342080004193e-10, 8.6837236170174419e-08, -3.0042364461660990e-13, -1.6447602079867515e-09, 7.1692757237439473e+00, 1.4051235716846360e-09, 2.0299571745335491e-07, ], [4.4586236428078324e-08, 1.4778536195200401e-15, -1.2698927098923122e-08, 2.0700868830708824e-12, -3.4090758232953601e-13, 3.5944299209716357e-09, -2.3304108770903399e-09, -2.0476791576342204e-13, 1.1991626100749824e-13, 1.7515557943344401e-13, -2.4140510132800076e-08, 4.5783251231970019e-13, 6.1696905899076716e-11, 1.4051235716846360e-09, 1.5934878848302378e+03, 1.8436122784045523e-07, ], [7.5926541334340091e+03, -5.9081931657789675e-09, 5.4876824445068707e-11, 1.1469626965838961e-08, -1.0015541509455579e-08, 5.1258896675578285e+02, 6.1958812465553278e-09, -1.5062730569320907e-09, 5.0418793226931838e-11, 5.6745605532123982e-09, 7.0298294089207484e+03, 1.2762992130883418e-07, 5.7980872670520632e-08, 2.0299571745335491e-07, 1.8436122784045523e-07, 1.5268031954481239e+04, ],])

point = np.zeros((K.dim, 1))
point[0] = t
point[1:] = sym.mat_to_vec(X)

K.get_point(point)

print(K.t)
print(K.X)

K.get_feas()
K.get_grad()


# HX = np.random.rand(nm, nm) - 0.5
# HX = HX + HX.T
H = np.zeros((K.dim, 1))
H[0] = Ht
H[1:] = sym.mat_to_vec(HX)

print("Ht: ", H[0])
print("Hx: ", HX)

prod = K.invhess_prod(H)
print("err: ", np.linalg.norm(K.hess_prod(prod) - H))

dder3 = K.dder3(H)